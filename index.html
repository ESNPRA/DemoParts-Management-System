<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEMOé›¶ä»¶ç®¡ç†ç³»çµ±</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft JhengHei', Arial, sans-serif; background: #f8fafc; min-height: 100vh; }
        .container { background: white; width: 100%; min-height: 100vh; display: flex; flex-direction: column; }
        .header { background: linear-gradient(135deg, #4f46e5, #7c3aed); color: white; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header h1 { font-size: 24px; font-weight: 600; }
        .user-info { display: flex; align-items: center; gap: 15px; font-size: 14px; }
        .content { padding: 30px; flex: 1; }
        .page { display: none; }
        .page.active { display: block; }
        .nav-buttons { display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; }
        .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.3s ease; text-decoration: none; display: inline-block; }
        .btn-primary { background: #4f46e5; color: white; }
        .btn-primary:hover { background: #4338ca; transform: translateY(-2px); }
        .btn-secondary { background: #6b7280; color: white; }
        .btn-secondary:hover { background: #4b5563; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover { background: #d97706; }
        .login-form { max-width: 400px; margin: 50px auto; padding: 40px; text-align: center; background: white; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #374151; }
        .form-control { width: 100%; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px; transition: border-color 0.3s ease; }
        .form-control:focus { outline: none; border-color: #4f46e5; }
        .table-container { overflow-x: auto; background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { padding: 15px; text-align: left; border-bottom: 1px solid #e5e7eb; vertical-align: top; }
        .table th { background: #f9fafb; font-weight: 600; color: #374151; }
        .table tr:hover { background: #f9fafb; }
        .status-badge { padding: 4px 8px; border-radius: 20px; font-size: 12px; font-weight: 500; }
        .status-available { background: #dcfce7; color: #166534; }
        .status-borrowed { background: #fef3c7; color: #92400e; }
        .search-bar { margin-bottom: 20px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        .search-bar input { flex: 1; min-width: 200px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; border-radius: 12px; padding: 30px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h2 { color: #374151; }
        .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280; }
        .close-btn:hover { color: #374151; }
        .file-upload { position: relative; display: inline-block; width: 100%; }
        .file-upload input[type=file] { position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; }
        .file-upload-label { display: block; padding: 12px 16px; border: 2px dashed #d1d5db; border-radius: 8px; text-align: center; cursor: pointer; transition: all 0.3s ease; }
        .file-upload-label:hover { border-color: #4f46e5; background: #f8fafc; }
        .image-preview { max-width: 100px; max-height: 100px; border-radius: 8px; border: 1px solid #e5e7eb; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .edit-input { width: 100%; padding: 4px 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 12px; }
        .admin-controls { display: flex; gap: 5px; align-items: center; }
        .form-control.error {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
        
        .error-message {
            color: #ef4444;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        @media (max-width: 768px) { .content { padding: 20px; } .nav-buttons { flex-direction: column; } .btn { width: 100%; text-align: center; } .form-row { grid-template-columns: 1fr; } .table th, .table td { padding: 10px; font-size: 12px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header" id="mainHeader" style="display: none;">
            <h1>DEMOé›¶ä»¶ç®¡ç†ç³»çµ±</h1>
            <div class="user-info">
                <span id="currentUser">æœªç™»å…¥</span>
                <button class="btn btn-secondary" onclick="logout()">ç™»å‡º</button>
            </div>
        </div>

        <div id="loginPage" class="page active">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center;">
                <div class="login-form">
                    <h2 style="margin-bottom: 30px; color: #374151;">ç³»çµ±ç™»å…¥</h2>
                    <div class="form-group">
                        <label for="email">ä¿¡ç®±</label>
                        <input type="email" id="email" class="form-control" placeholder="è«‹è¼¸å…¥ä¿¡ç®±">
                    </div>
                    <div class="form-group">
                        <label for="password">å¯†ç¢¼</label>
                        <input type="password" id="password" class="form-control" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
                    </div>
                    <button class="btn btn-primary" onclick="login()" style="width: 100%;">ç™»å…¥</button>
                </div>
            </div>
        </div>

        <div class="content">
            <div id="mainPage" class="page">
                <div class="nav-buttons">
                    <button class="btn btn-primary" onclick="showPage('searchPage')">æŸ¥è©¢æ—¢æœ‰è³‡æ–™</button>
                    <button class="btn btn-primary" onclick="showPage('addPartPage')" id="addPartBtn" style="display: none;">è³‡æ–™è¼¸å…¥</button>
                    <button class="btn btn-primary" onclick="showPage('borrowRecordsPage')" id="borrowRecordsBtn" style="display: none;">å€Ÿå‡ºç´€éŒ„</button>
                    <button class="btn btn-primary" onclick="showPage('userManagementPage')" id="userMgmtBtn" style="display: none;">æ¬Šé™ç®¡ç†</button>
                </div>
                <div style="text-align: center; margin-top: 50px;">
                    <h2 style="color: #374151; margin-bottom: 20px;">æ­¡è¿ä½¿ç”¨DEMOé›¶ä»¶ç®¡ç†ç³»çµ±</h2>
                    <p style="color: #6b7280;">è«‹é¸æ“‡ä¸Šæ–¹åŠŸèƒ½é–‹å§‹ä½¿ç”¨</p>
                </div>
            </div>

            <div id="searchPage" class="page">
                <h2 style="margin-bottom: 20px; color: #374151;">æŸ¥è©¢æ—¢æœ‰è³‡æ–™</h2>
                <button class="btn btn-secondary" onclick="showPage('mainPage')" style="margin-bottom: 20px;">è¿”å›ä¸»é </button>
                <div class="search-bar">
                    <input type="text" id="searchInput" class="form-control" placeholder="è«‹è¼¸å…¥å‹è™Ÿé—œéµå­—æœå°‹" oninput="searchParts()">
                    <select id="sortBy" class="form-control" style="max-width: 200px;" onchange="searchParts()">
                        <option value="model">ä¾å‹è™Ÿæ’åº</option>
                        <option value="status">ä¾åœ¨åº«ç‹€æ…‹æ’åº</option>
                    </select>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>å‹è™Ÿ</th>
                                <th>åœ¨åº«æ•¸é‡</th>
                                <th>åœ¨åº«ç‹€æ…‹</th>
                                <th>å€Ÿå‡ºå€é–“</th>
                                <th id="borrowerHeader" style="display: none;">å€Ÿå‡ºäºº</th>
                                <th id="contactHeader" style="display: none;">è¯çµ¡æ–¹å¼</th>
                                <th id="descriptionHeader" style="display: none;">éœ€æ±‚æ•˜è¿°</th>
                                <th>ç…§ç‰‡</th>
                                <th>å€Ÿå‡ºç”³è«‹</th>
                            </tr>
                        </thead>
                        <tbody id="partsTableBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="addPartPage" class="page">
                <h2 style="margin-bottom: 20px; color: #374151;">è³‡æ–™è¼¸å…¥</h2>
                <button class="btn btn-secondary" onclick="showPage('mainPage')" style="margin-bottom: 20px;">è¿”å›ä¸»é </button>
                <div style="max-width: 800px; margin: 0 auto;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="partModel">å‹è™Ÿ *</label>
                            <input type="text" id="partModel" class="form-control" placeholder="è«‹è¼¸å…¥é›¶ä»¶å‹è™Ÿ">
                        </div>
                        <div class="form-group">
                            <label for="partQuantity">åœ¨åº«æ•¸é‡ *</label>
                            <select id="partQuantity" class="form-control"></select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="partLocation">é›¶ä»¶å­˜æ”¾åœ°é» *</label>
                        <input type="text" id="partLocation" class="form-control" placeholder="è«‹è¼¸å…¥å­˜æ”¾åœ°é»">
                    </div>
                    <div class="form-group">
                        <label for="partNotes">å‚™è¨»</label>
                        <textarea id="partNotes" class="form-control" rows="3" placeholder="è«‹è¼¸å…¥å‚™è¨»è³‡è¨Š"></textarea>
                    </div>
                    <div class="form-group">
                        <label>é›¶ä»¶ç…§ç‰‡ (JPG/JPEGæ ¼å¼)</label>
                        <div class="file-upload">
                            <input type="file" id="partImage" accept=".jpg,.jpeg">
                            <label for="partImage" class="file-upload-label">é»æ“Šä¸Šå‚³ç…§ç‰‡ (JPG/JPEGæ ¼å¼)</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" id="partSearchable" checked> æ˜¯å¦èƒ½è¢«æŸ¥è©¢åˆ°</label>
                    </div>
                    <button class="btn btn-success" onclick="addPart()" style="width: 100%;">æ–°å¢é›¶ä»¶</button>
                </div>
            </div>

            <div id="borrowRecordsPage" class="page">
                <h2 style="margin-bottom: 20px; color: #374151;">å€Ÿå‡ºç´€éŒ„</h2>
                <button class="btn btn-secondary" onclick="showPage('mainPage')" style="margin-bottom: 20px;">è¿”å›ä¸»é </button>
                <div class="search-bar">
                    <input type="text" id="recordSearchInput" class="form-control" placeholder="è«‹è¼¸å…¥å‹è™Ÿæˆ–å€Ÿå‡ºäººé—œéµå­—æœå°‹" oninput="searchBorrowRecords()">
                    <select id="recordSortBy" class="form-control" style="max-width: 200px;" onchange="searchBorrowRecords()">
                        <option value="date">ä¾ç”³è«‹æ—¥æœŸæ’åº</option>
                        <option value="model">ä¾å‹è™Ÿæ’åº</option>
                        <option value="borrower">ä¾å€Ÿå‡ºäººæ’åº</option>
                    </select>
                    <button class="btn btn-primary" onclick="searchBorrowRecords()">æœå°‹</button>
                </div>
                <div style="margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
                    <strong>çµ±è¨ˆè³‡è¨Šï¼š</strong>
                    <span style="margin-left: 20px;">ç¸½å€Ÿå‡ºç´€éŒ„: <span id="totalRecords">0</span> ç­†</span>
                    <span style="margin-left: 20px;">ä¸åŒé›¶ä»¶ç¨®é¡: <span id="uniqueParts">0</span> ç¨®</span>
                    <span style="margin-left: 20px;">ç¸½å€Ÿå‡ºæ•¸é‡: <span id="totalBorrowedQuantity">0</span> å€‹</span>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ç”³è«‹æ—¥æœŸ</th>
                                <th>é›¶ä»¶å‹è™Ÿ</th>
                                <th>å€Ÿç”¨æ•¸é‡</th>
                                <th>å€Ÿå‡ºäºº/å–®ä½</th>
                                <th>è¯çµ¡æ–¹å¼</th>
                                <th>å€Ÿå‡ºå€é–“</th>
                                <th>å€Ÿç”¨éœ€æ±‚æ•˜è¿°</th>
                            </tr>
                        </thead>
                        <tbody id="borrowRecordsTableBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="userManagementPage" class="page">
                <h2 style="margin-bottom: 20px; color: #374151;">æ¬Šé™ç®¡ç†</h2>
                <button class="btn btn-secondary" onclick="showPage('mainPage')" style="margin-bottom: 20px;">è¿”å›ä¸»é </button>
                <div style="max-width: 600px; margin: 0 auto;">
                    <h3 style="margin-bottom: 20px;">æ–°å¢å¸³è™Ÿ</h3>
                    <div class="form-group">
                        <label for="newUserEmail">ä¿¡ç®± *</label>
                        <input type="email" id="newUserEmail" class="form-control" placeholder="è«‹è¼¸å…¥ä¿¡ç®±">
                    </div>
                    <div class="form-group">
                        <label for="newUserPassword">å¯†ç¢¼ *</label>
                        <input type="password" id="newUserPassword" class="form-control" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
                    </div>
                    <div class="form-group">
                        <label for="newUserRole">æ¬Šé™ *</label>
                        <select id="newUserRole" class="form-control">
                            <option value="user">ä¸€èˆ¬ä½¿ç”¨è€…</option>
                            <option value="admin">ç®¡ç†å“¡</option>
                        </select>
                    </div>
                    <button class="btn btn-success" onclick="addUser()" style="width: 100%; margin-bottom: 30px;">æ–°å¢å¸³è™Ÿ</button>
                </div>
                <h3 style="margin-bottom: 20px;">ç®¡ç†å“¡å¸³è™Ÿä¿¡ç®±</h3>
                <div id="adminEmails" style="margin-bottom: 30px; padding: 15px; background: #f9fafb; border-radius: 8px;"></div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr><th>ä¿¡ç®±</th><th>æ¬Šé™</th><th>æ“ä½œ</th></tr>
                        </thead>
                        <tbody id="usersTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="borrowModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ç”³è«‹å€Ÿç”¨</h2>
                <button class="close-btn" onclick="closeBorrowModal()">&times;</button>
            </div>
            <div class="form-group">
                <label>ç”³è«‹å€Ÿç”¨å‹è™Ÿ</label>
                <input type="text" id="borrowPartModel" class="form-control" readonly>
            </div>
            <div class="form-group">
                <label>å¯å€Ÿç”¨æ•¸é‡</label>
                <input type="text" id="availableQuantity" class="form-control" readonly>
            </div>
            <div class="form-group">
                <label for="borrowQuantity">å€Ÿç”¨æ•¸é‡ *</label>
                <select id="borrowQuantity" class="form-control"></select>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="borrowerName">å€Ÿå‡ºäºº *</label>
                    <input type="text" id="borrowerName" class="form-control" placeholder="è«‹è¼¸å…¥å€Ÿå‡ºäººå§“å">
                    <div class="error-message" id="borrowerNameError">è«‹è¼¸å…¥å€Ÿå‡ºäººå§“åï¼ˆè‡³å°‘2å€‹å­—å…ƒï¼‰</div>
                </div>
                <div class="form-group">
                    <label for="companyName">å–®ä½åç¨± *</label>
                    <input type="text" id="companyName" class="form-control" placeholder="è«‹è¼¸å…¥å–®ä½åç¨±">
                    <div class="error-message" id="companyNameError">è«‹è¼¸å…¥å–®ä½åç¨±ï¼ˆè‡³å°‘2å€‹å­—å…ƒï¼‰</div>
                </div>
            </div>
            <div class="form-group">
                <label for="borrowerEmail">å€Ÿå‡ºäººä¿¡ç®± *</label>
                <input type="email" id="borrowerEmail" class="form-control" placeholder="è«‹è¼¸å…¥å€Ÿå‡ºäººä¿¡ç®±">
                <div class="error-message" id="borrowerEmailError">è«‹è¼¸å…¥æœ‰æ•ˆçš„ä¿¡ç®±æ ¼å¼ï¼Œä¾‹å¦‚ï¼šexample@domain.com</div>
            </div>
            <div class="form-group">
                <label for="borrowerPhone">å€Ÿå‡ºäººé›»è©± *</label>
                <input type="tel" id="borrowerPhone" class="form-control" placeholder="è«‹è¼¸å…¥å€Ÿå‡ºäººé›»è©±">
                <div class="error-message" id="borrowerPhoneError">è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»è©±è™Ÿç¢¼ï¼ˆè‡³å°‘9ä½æ•¸å­—ï¼‰</div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="borrowStartDate">å€Ÿç”¨é–‹å§‹æ—¥æœŸ *</label>
                    <input type="date" id="borrowStartDate" class="form-control">
                    <div class="error-message" id="borrowStartDateError">é–‹å§‹æ—¥æœŸä¸èƒ½æ—©æ–¼ä»Šå¤©</div>
                </div>
                <div class="form-group">
                    <label for="borrowEndDate">å¯¦éš›æ­¸é‚„æ—¥æœŸ *</label>
                    <input type="date" id="borrowEndDate" class="form-control">
                    <div class="error-message" id="borrowEndDateError">æ­¸é‚„æ—¥æœŸå¿…é ˆæ™šæ–¼é–‹å§‹æ—¥æœŸä¸”ä¸è¶…éä¸€å€‹æœˆ</div>
                </div>
            </div>
            <div class="form-group">
                <label for="borrowDescription">å€Ÿç”¨éœ€æ±‚æ•˜è¿° *</label>
                <textarea id="borrowDescription" class="form-control" rows="3" placeholder="è«‹æè¿°å€Ÿç”¨éœ€æ±‚"></textarea>
                <div class="error-message" id="borrowDescriptionError">è«‹è©³ç´°æè¿°å€Ÿç”¨éœ€æ±‚ï¼ˆè‡³å°‘10å€‹å­—å…ƒï¼‰</div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeBorrowModal()">å–æ¶ˆ</button>
                <button class="btn btn-success" onclick="submitBorrowRequest()">ç”³è«‹</button>
            </div>
        </div>
    </div>

    <div id="successModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="color: #10b981;" id="successModalTitle">âœ… æ“ä½œæˆåŠŸï¼</h2>
                <button class="close-btn" onclick="closeSuccessModal()">&times;</button>
            </div>
            <div id="successContent" style="margin: 20px 0; line-height: 1.6;"></div>
            <div style="display: flex; justify-content: center;">
                <button class="btn btn-success" onclick="closeSuccessModal()">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <script>
        let users = [
            { email: '11', password: '22', role: 'admin' },
            { email: 'admin@example.com', password: 'admin123', role: 'admin' },
            { email: 'user@example.com', password: 'user123', role: 'user' }
        ];
        let parts = [];
        let borrowRecords = [];
        let currentUser = null;
        let currentBorrowingPart = null;

        function init() {
            initQuantityDropdown();
            setDateConstraints();
        }

        function initQuantityDropdown() {
            const quantitySelect = document.getElementById('partQuantity');
            if (quantitySelect) {
                quantitySelect.innerHTML = '';
                for (let i = 1; i <= 100; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    quantitySelect.appendChild(option);
                }
            }
        }

        function setDateConstraints() {
            const today = new Date().toISOString().split('T')[0];
            const startDateInput = document.getElementById('borrowStartDate');
            const endDateInput = document.getElementById('borrowEndDate');
            
            if (startDateInput) {
                startDateInput.min = today;
                startDateInput.addEventListener('change', function() {
                    const startDate = new Date(this.value);
                    const maxEndDate = new Date(startDate);
                    maxEndDate.setMonth(startDate.getMonth() + 1);
                    
                    endDateInput.min = this.value;
                    endDateInput.max = maxEndDate.toISOString().split('T')[0];
                    
                    if (endDateInput.value && new Date(endDateInput.value) > maxEndDate) {
                        endDateInput.value = maxEndDate.toISOString().split('T')[0];
                    }
                });
            }
        }

        function getTimestamp() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            return year + '/' + month + '/' + day + ' - ' + hours + ':' + minutes + ':' + seconds;
        }

        function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            if (!email || !password) {
                alert('è«‹è¼¸å…¥ä¿¡ç®±å’Œå¯†ç¢¼');
                return;
            }
            const user = users.find(u => u.email === email && u.password === password);
            if (user) {
                currentUser = user;
                document.getElementById('currentUser').textContent = user.email + ' (' + (user.role === 'admin' ? 'ç®¡ç†å“¡' : 'ä¸€èˆ¬ä½¿ç”¨è€…') + ')';
                document.getElementById('mainHeader').style.display = 'flex';
                if (user.role === 'admin') {
                    document.getElementById('addPartBtn').style.display = 'inline-block';
                    document.getElementById('borrowRecordsBtn').style.display = 'inline-block';
                    document.getElementById('userMgmtBtn').style.display = 'inline-block';
                    document.getElementById('borrowerHeader').style.display = 'table-cell';
                    document.getElementById('contactHeader').style.display = 'table-cell';
                    document.getElementById('descriptionHeader').style.display = 'table-cell';
                }
                showPage('mainPage');
            } else {
                alert('ä¿¡ç®±æˆ–å¯†ç¢¼éŒ¯èª¤');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('currentUser').textContent = 'æœªç™»å…¥';
            document.getElementById('mainHeader').style.display = 'none';
            document.getElementById('addPartBtn').style.display = 'none';
            document.getElementById('borrowRecordsBtn').style.display = 'none';
            document.getElementById('userMgmtBtn').style.display = 'none';
            document.getElementById('borrowerHeader').style.display = 'none';
            document.getElementById('contactHeader').style.display = 'none';
            document.getElementById('descriptionHeader').style.display = 'none';
            showPage('loginPage');
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            if (pageId === 'searchPage') {
                loadParts();
            } else if (pageId === 'userManagementPage') {
                loadUsers();
                loadAdminEmails();
            } else if (pageId === 'borrowRecordsPage') {
                loadBorrowRecords();
            }
        }

        function addPart() {
            const model = document.getElementById('partModel').value.trim();
            const quantity = parseInt(document.getElementById('partQuantity').value);
            const location = document.getElementById('partLocation').value.trim();
            const notes = document.getElementById('partNotes').value.trim();
            const searchable = document.getElementById('partSearchable').checked;
            const imageFile = document.getElementById('partImage').files[0];

            if (!model || !location) {
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½');
                return;
            }
            if (parts.find(p => p.model === model)) {
                alert('æ­¤å‹è™Ÿå·²å­˜åœ¨ï¼Œè«‹ä½¿ç”¨ä¸åŒçš„å‹è™Ÿ');
                return;
            }
            if (imageFile && !['image/jpeg', 'image/jpg'].includes(imageFile.type)) {
                alert('è«‹ä¸Šå‚³ JPG æˆ– JPEG æ ¼å¼çš„åœ–ç‰‡');
                return;
            }

            const newPart = {
                id: Date.now(),
                model: model,
                quantity: quantity,
                location: location,
                notes: notes || '',
                status: 'åœ¨åº«',
                borrower: 'N/A',
                borrowerEmail: 'N/A',
                borrowerPhone: 'N/A',
                borrowPeriod: 'N/A',
                description: 'N/A',
                searchable: searchable,
                createdAt: getTimestamp(),
                image: imageFile ? URL.createObjectURL(imageFile) : null
            };

            parts.push(newPart);
            showSuccessMessage(model, quantity, location, notes);
            
            document.getElementById('partModel').value = '';
            document.getElementById('partQuantity').value = '1';
            document.getElementById('partLocation').value = '';
            document.getElementById('partNotes').value = '';
            document.getElementById('partSearchable').checked = true;
            document.getElementById('partImage').value = '';
            const fileLabel = document.querySelector('.file-upload-label');
            if (fileLabel) {
                fileLabel.textContent = 'é»æ“Šä¸Šå‚³ç…§ç‰‡ (JPG/JPEGæ ¼å¼)';
            }
        }

        function showSuccessMessage(model, quantity, location, notes) {
            const successContent = document.getElementById('successContent');
            const successTitle = document.getElementById('successModalTitle');
            successTitle.textContent = 'âœ… é›¶ä»¶æ–°å¢æˆåŠŸï¼';
            successContent.innerHTML = '<div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border-left: 4px solid #10b981;"><strong>é›¶ä»¶è©³ç´°è³‡è¨Šï¼š</strong><br><br><strong>å‹è™Ÿï¼š</strong>' + model + '<br><strong>æ•¸é‡ï¼š</strong>' + quantity + '<br><strong>å­˜æ”¾åœ°é»ï¼š</strong>' + location + '<br>' + (notes ? '<strong>å‚™è¨»ï¼š</strong>' + notes + '<br>' : '') + '<br><span style="color: #10b981; font-weight: 600;">âœ¨ å·²ç¶“é †åˆ©æ–°å¢æ–°çš„é›¶ä»¶ã€‚</span></div>';
            document.getElementById('successModal').classList.add('active');
        }

        function showBorrowSuccessMessage(model, quantity, startDate, endDate, borrowerName) {
            const successContent = document.getElementById('successContent');
            const successTitle = document.getElementById('successModalTitle');
            successTitle.textContent = 'ğŸ‰ å€Ÿç”¨ç”³è«‹æˆåŠŸï¼';
            successContent.innerHTML = '<div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border-left: 4px solid #10b981;"><strong>ç”³è«‹è©³ç´°è³‡è¨Šï¼š</strong><br><br><strong>é›¶ä»¶å‹è™Ÿï¼š</strong>' + model + '<br><strong>å€Ÿç”¨æ•¸é‡ï¼š</strong>' + quantity + ' å€‹<br><strong>å€Ÿå‡ºå€é–“ï¼š</strong>' + startDate + ' è‡³ ' + endDate + '<br><strong>å€Ÿå‡ºäºº/å–®ä½ï¼š</strong>' + borrowerName + '<br><br><span style="color: #10b981; font-weight: 600;">âœ¨ ç³»çµ±å·²è‡ªå‹•ç™¼é€ç¢ºèªéƒµä»¶çµ¦ç”³è«‹äººå’Œç®¡ç†å“¡ã€‚</span></div>';
            document.getElementById('successModal').classList.add('active');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
        }

        function loadParts() {
            const tbody = document.getElementById('partsTableBody');
            tbody.innerHTML = '';
            const searchTerm = document.getElementById('searchInput') ? document.getElementById('searchInput').value.toLowerCase() : '';
            const sortBy = document.getElementById('sortBy') ? document.getElementById('sortBy').value : 'model';
            let filteredParts = parts.filter(part => part.searchable && part.model.toLowerCase().includes(searchTerm));
            filteredParts.sort((a, b) => {
                if (sortBy === 'model') return a.model.localeCompare(b.model);
                if (sortBy === 'status') return a.status.localeCompare(b.status);
                return 0;
            });
            filteredParts.forEach(part => {
                const row = document.createElement('tr');
                let borrowPeriodDisplay = 'N/A';
                if (part.status === 'å·²å€Ÿå‡º') {
                    const partRecords = borrowRecords.filter(r => r.partId === part.id);
                    if (partRecords.length > 0) {
                        borrowPeriodDisplay = '<div class="borrow-records">';
                        partRecords.forEach(record => {
                            borrowPeriodDisplay += '<div style="padding: 5px 0; border-bottom: 1px solid #f3f4f6;">ç”³è«‹æ—¥æœŸ: ' + record.applicationDate + '<br>å€Ÿç”¨æ•¸é‡: ' + record.quantity + '<br>å€Ÿå‡ºå€é–“: ' + record.startDate + ' è‡³ ' + record.endDate + '</div>';
                        });
                        borrowPeriodDisplay += '</div>';
                    } else {
                        borrowPeriodDisplay = part.borrowPeriod;
                    }
                }
                let actionCell = '';
                if (part.status === 'åœ¨åº«' && part.quantity > 0) {
                    actionCell = '<button class="btn btn-primary" onclick="openBorrowModal(' + part.id + ')">ç”³è«‹å€Ÿç”¨</button>';
                } else {
                    actionCell = '<span style="color: #6b7280;">ç„¡æ³•ç”³è«‹</span>';
                }
                const imageCell = part.image ? '<img src="' + part.image + '" class="image-preview" alt="é›¶ä»¶ç…§ç‰‡">' : '<span style="color: #6b7280;">ç„¡ç…§ç‰‡</span>';
                let quantityCell = part.quantity.toString();
                let statusCell = '<span class="status-badge ' + (part.status === 'åœ¨åº«' ? 'status-available' : 'status-borrowed') + '">' + part.status + '</span>';
                if (currentUser && currentUser.role === 'admin') {
                    quantityCell = '<div class="admin-controls"><input type="number" class="edit-input" value="' + part.quantity + '" min="0" onchange="updatePartQuantity(' + part.id + ', this.value)" style="width: 60px;"></div>';
                    statusCell = '<select class="edit-input" onchange="updatePartStatus(' + part.id + ', this.value)"><option value="åœ¨åº«"' + (part.status === 'åœ¨åº«' ? ' selected' : '') + '>åœ¨åº«</option><option value="å·²å€Ÿå‡º"' + (part.status === 'å·²å€Ÿå‡º' ? ' selected' : '') + '>å·²å€Ÿå‡º</option></select>';
                }
                const adminCells = currentUser && currentUser.role === 'admin' ? '<td>' + part.borrower + '</td><td>' + part.borrowerEmail + '<br>' + part.borrowerPhone + '</td><td>' + part.description + '</td>' : '';
                row.innerHTML = '<td>' + part.model + '</td><td>' + quantityCell + '</td><td>' + statusCell + '</td><td>' + borrowPeriodDisplay + '</td>' + adminCells + '<td>' + imageCell + '</td><td>' + actionCell + '</td>';
                tbody.appendChild(row);
            });
        }

        function updatePartQuantity(partId, newQuantity) {
            const part = parts.find(p => p.id === partId);
            if (part) {
                const quantity = parseInt(newQuantity) || 0;
                part.quantity = quantity;
                if (quantity > 0) {
                    part.status = 'åœ¨åº«';
                } else {
                    part.status = 'å·²å€Ÿå‡º';
                }
                loadParts();
                alert('é›¶ä»¶ ' + part.model + ' æ•¸é‡å·²æ›´æ–°ç‚º ' + quantity);
            }
        }

        function updatePartStatus(partId, newStatus) {
            const part = parts.find(p => p.id === partId);
            if (part) {
                part.status = newStatus;
                loadParts();
                alert('é›¶ä»¶ ' + part.model + ' ç‹€æ…‹å·²æ›´æ–°ç‚º ' + newStatus);
            }
        }

        function searchParts() {
            loadParts();
        }

        function openBorrowModal(partId) {
            const part = parts.find(p => p.id === partId);
            if (!part || part.status !== 'åœ¨åº«' || part.quantity <= 0) {
                alert('æ­¤é›¶ä»¶ç„¡æ³•å€Ÿç”¨');
                return;
            }
            currentBorrowingPart = part;
            document.getElementById('borrowPartModel').value = part.model;
            document.getElementById('availableQuantity').value = part.quantity;
            
            const quantitySelect = document.getElementById('borrowQuantity');
            quantitySelect.innerHTML = '';
            for (let i = 1; i <= part.quantity; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i + ' å€‹';
                quantitySelect.appendChild(option);
            }
            
            const today = new Date();
            const nextMonth = new Date(today);
            nextMonth.setMonth(today.getMonth() + 1);
            document.getElementById('borrowStartDate').value = today.toISOString().split('T')[0];
            document.getElementById('borrowEndDate').value = nextMonth.toISOString().split('T')[0];
            document.getElementById('borrowModal').classList.add('active');
        }

        function closeBorrowModal() {
            document.getElementById('borrowModal').classList.remove('active');
            currentBorrowingPart = null;
            
            // æ¸…ç©ºè¡¨å–®
            document.getElementById('borrowerName').value = '';
            document.getElementById('companyName').value = '';
            document.getElementById('borrowerEmail').value = '';
            document.getElementById('borrowerPhone').value = '';
            document.getElementById('borrowDescription').value = '';
            
            // æ¸…é™¤éŒ¯èª¤æç¤º
            clearBorrowFormErrors();
        }

        function clearBorrowFormErrors() {
            const errorElements = document.querySelectorAll('#borrowModal .error-message');
            const inputElements = document.querySelectorAll('#borrowModal .form-control');
            
            errorElements.forEach(element => {
                element.classList.remove('show');
            });
            
            inputElements.forEach(element => {
                element.classList.remove('error');
            });
        }

        function showFieldError(fieldId, errorId) {
            document.getElementById(fieldId).classList.add('error');
            document.getElementById(errorId).classList.add('show');
        }

        function submitBorrowRequest() {
            if (!currentBorrowingPart) return;
            
            // æ¸…é™¤ä¹‹å‰çš„éŒ¯èª¤æç¤º
            clearBorrowFormErrors();
            
            const borrowerName = document.getElementById('borrowerName').value.trim();
            const companyName = document.getElementById('companyName').value.trim();
            const borrowerEmail = document.getElementById('borrowerEmail').value.trim();
            const borrowerPhone = document.getElementById('borrowerPhone').value.trim();
            const borrowQuantity = parseInt(document.getElementById('borrowQuantity').value);
            const startDate = document.getElementById('borrowStartDate').value;
            const endDate = document.getElementById('borrowEndDate').value;
            const description = document.getElementById('borrowDescription').value.trim();
            
            let hasErrors = false;
            let errorMessage = 'è«‹ä¿®æ­£ä»¥ä¸‹æ¬„ä½ï¼š\n\n';
            
            // é©—è­‰å€Ÿå‡ºäººå§“å
            if (!borrowerName || borrowerName.length < 2) {
                showFieldError('borrowerName', 'borrowerNameError');
                errorMessage += 'â€¢ å€Ÿå‡ºäººå§“åï¼šè«‹è¼¸å…¥è‡³å°‘2å€‹å­—å…ƒçš„å§“å\n';
                hasErrors = true;
            }
            
            // é©—è­‰å–®ä½åç¨±
            if (!companyName || companyName.length < 2) {
                showFieldError('companyName', 'companyNameError');
                errorMessage += 'â€¢ å–®ä½åç¨±ï¼šè«‹è¼¸å…¥è‡³å°‘2å€‹å­—å…ƒçš„å–®ä½åç¨±\n';
                hasErrors = true;
            }
            
            // é©—è­‰ä¿¡ç®±æ ¼å¼
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!borrowerEmail || !emailRegex.test(borrowerEmail)) {
                showFieldError('borrowerEmail', 'borrowerEmailError');
                errorMessage += 'â€¢ å€Ÿå‡ºäººä¿¡ç®±ï¼šè«‹è¼¸å…¥æœ‰æ•ˆçš„ä¿¡ç®±æ ¼å¼ï¼Œä¾‹å¦‚ï¼šexample@domain.com\n';
                hasErrors = true;
            }
            
            // é©—è­‰é›»è©±è™Ÿç¢¼
            const phoneRegex = /^\d{9,}$/;
            if (!borrowerPhone || !phoneRegex.test(borrowerPhone.replace(/[\s\-\(\)]/g, ''))) {
                showFieldError('borrowerPhone', 'borrowerPhoneError');
                errorMessage += 'â€¢ å€Ÿå‡ºäººé›»è©±ï¼šè«‹è¼¸å…¥æœ‰æ•ˆçš„é›»è©±è™Ÿç¢¼ï¼ˆè‡³å°‘9ä½æ•¸å­—ï¼‰\n';
                hasErrors = true;
            }
            
            // é©—è­‰æ—¥æœŸ
            if (!startDate) {
                showFieldError('borrowStartDate', 'borrowStartDateError');
                errorMessage += 'â€¢ å€Ÿç”¨é–‹å§‹æ—¥æœŸï¼šè«‹é¸æ“‡é–‹å§‹æ—¥æœŸ\n';
                hasErrors = true;
            } else {
                const start = new Date(startDate);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                if (start < today) {
                    showFieldError('borrowStartDate', 'borrowStartDateError');
                    errorMessage += 'â€¢ å€Ÿç”¨é–‹å§‹æ—¥æœŸï¼šé–‹å§‹æ—¥æœŸä¸èƒ½æ—©æ–¼ä»Šå¤©\n';
                    hasErrors = true;
                }
            }
            
            if (!endDate) {
                showFieldError('borrowEndDate', 'borrowEndDateError');
                errorMessage += 'â€¢ å¯¦éš›æ­¸é‚„æ—¥æœŸï¼šè«‹é¸æ“‡æ­¸é‚„æ—¥æœŸ\n';
                hasErrors = true;
            } else if (startDate && endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);
                
                if (end <= start) {
                    showFieldError('borrowEndDate', 'borrowEndDateError');
                    errorMessage += 'â€¢ å¯¦éš›æ­¸é‚„æ—¥æœŸï¼šæ­¸é‚„æ—¥æœŸå¿…é ˆæ™šæ–¼é–‹å§‹æ—¥æœŸ\n';
                    hasErrors = true;
                } else {
                    // æª¢æŸ¥æ˜¯å¦è¶…éä¸€å€‹æœˆ
                    const oneMonthLater = new Date(start);
                    oneMonthLater.setMonth(start.getMonth() + 1);
                    if (end > oneMonthLater) {
                        showFieldError('borrowEndDate', 'borrowEndDateError');
                        errorMessage += 'â€¢ å¯¦éš›æ­¸é‚„æ—¥æœŸï¼šå€Ÿç”¨æœŸé™ä¸èƒ½è¶…éä¸€å€‹æœˆ\n';
                        hasErrors = true;
                    }
                }
            }
            
            // é©—è­‰å€Ÿç”¨éœ€æ±‚æ•˜è¿°
            if (!description || description.length < 10) {
                showFieldError('borrowDescription', 'borrowDescriptionError');
                errorMessage += 'â€¢ å€Ÿç”¨éœ€æ±‚æ•˜è¿°ï¼šè«‹è©³ç´°æè¿°å€Ÿç”¨éœ€æ±‚ï¼ˆè‡³å°‘10å€‹å­—å…ƒï¼‰\n';
                hasErrors = true;
            }
            
            // å¦‚æœæœ‰éŒ¯èª¤ï¼Œé¡¯ç¤ºæç¤ºè¨Šæ¯ä¸¦åœæ­¢æäº¤
            if (hasErrors) {
                alert(errorMessage);
                return;
            }
            
            // å¦‚æœæ‰€æœ‰é©—è­‰éƒ½é€šéï¼Œç¹¼çºŒåŸæœ‰çš„æäº¤é‚è¼¯
            const applicationTime = getTimestamp();
            const borrowerFullName = borrowerName + '/' + companyName;
            const borrowRecord = {
                id: Date.now(),
                partId: currentBorrowingPart.id,
                partModel: currentBorrowingPart.model,
                quantity: borrowQuantity,
                borrowerName: borrowerFullName,
                borrowerEmail: borrowerEmail,
                borrowerPhone: borrowerPhone,
                startDate: startDate,
                endDate: endDate,
                description: description,
                applicationDate: applicationTime
            };
            borrowRecords.push(borrowRecord);
            currentBorrowingPart.quantity = currentBorrowingPart.quantity - borrowQuantity;
            if (currentBorrowingPart.quantity > 0) {
                currentBorrowingPart.status = 'åœ¨åº«';
            } else {
                currentBorrowingPart.status = 'å·²å€Ÿå‡º';
            }
            currentBorrowingPart.borrower = borrowerFullName;
            currentBorrowingPart.borrowerEmail = borrowerEmail;
            currentBorrowingPart.borrowerPhone = borrowerPhone;
            currentBorrowingPart.borrowPeriod = startDate + ' è‡³ ' + endDate;
            currentBorrowingPart.description = description;
            
            showBorrowSuccessMessage(currentBorrowingPart.model, borrowQuantity, startDate, endDate, borrowerFullName);
            loadParts();
            closeBorrowModal();
        }

        function loadBorrowRecords() {
            const tbody = document.getElementById('borrowRecordsTableBody');
            tbody.innerHTML = '';
            
            const searchTerm = document.getElementById('recordSearchInput') ? document.getElementById('recordSearchInput').value.toLowerCase() : '';
            const sortBy = document.getElementById('recordSortBy') ? document.getElementById('recordSortBy').value : 'date';
            
            let filteredRecords = borrowRecords.filter(record => 
                record.partModel.toLowerCase().includes(searchTerm) || 
                record.borrowerName.toLowerCase().includes(searchTerm)
            );
            
            filteredRecords.sort((a, b) => {
                if (sortBy === 'date') {
                    return new Date(b.applicationDate) - new Date(a.applicationDate);
                } else if (sortBy === 'model') {
                    return a.partModel.localeCompare(b.partModel);
                } else if (sortBy === 'borrower') {
                    return a.borrowerName.localeCompare(b.borrowerName);
                }
                return 0;
            });
            
            filteredRecords.forEach(record => {
                const row = document.createElement('tr');
                row.innerHTML = '<td>' + record.applicationDate + '</td>' +
                               '<td>' + record.partModel + '</td>' +
                               '<td>' + record.quantity + '</td>' +
                               '<td>' + record.borrowerName + '</td>' +
                               '<td>' + record.borrowerEmail + '<br>' + record.borrowerPhone + '</td>' +
                               '<td>' + record.startDate + ' è‡³ ' + record.endDate + '</td>' +
                               '<td>' + record.description + '</td>';
                tbody.appendChild(row);
            });
            
            updateBorrowRecordsStats();
        }
        
        function updateBorrowRecordsStats() {
            const totalRecords = borrowRecords.length;
            const uniquePartModels = new Set(borrowRecords.map(record => record.partModel)).size;
            const totalBorrowedQuantity = borrowRecords.reduce((sum, record) => sum + record.quantity, 0);
            
            document.getElementById('totalRecords').textContent = totalRecords;
            document.getElementById('uniqueParts').textContent = uniquePartModels;
            document.getElementById('totalBorrowedQuantity').textContent = totalBorrowedQuantity;
        }
        
        function searchBorrowRecords() {
            loadBorrowRecords();
        }

        function loadUsers() {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';
            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = '<td>' + user.email + '</td><td><span class="status-badge ' + (user.role === 'admin' ? 'status-borrowed' : 'status-available') + '">' + (user.role === 'admin' ? 'ç®¡ç†å“¡' : 'ä¸€èˆ¬ä½¿ç”¨è€…') + '</span></td><td><select onchange="changeUserRole(\'' + user.email + '\', this.value)" class="form-control" style="width: auto; display: inline-block; margin-right: 10px;"><option value="user"' + (user.role === 'user' ? ' selected' : '') + '>ä¸€èˆ¬ä½¿ç”¨è€…</option><option value="admin"' + (user.role === 'admin' ? ' selected' : '') + '>ç®¡ç†å“¡</option></select><button class="btn btn-warning" onclick="alert(\'ä¿®æ”¹å¯†ç¢¼åŠŸèƒ½\')" style="margin-right: 10px;">ä¿®æ”¹å¯†ç¢¼</button><button class="btn btn-danger" onclick="deleteUser(\'' + user.email + '\')"' + (user.email === (currentUser ? currentUser.email : '') ? ' disabled' : '') + '>åˆªé™¤å¸³è™Ÿ</button></td>';
                tbody.appendChild(row);
            });
        }

        function loadAdminEmails() {
            const adminEmailsDiv = document.getElementById('adminEmails');
            const adminEmails = users.filter(u => u.role === 'admin').map(u => u.email);
            if (adminEmails.length > 0) {
                adminEmailsDiv.innerHTML = '<strong>ç›®å‰ç®¡ç†å“¡ä¿¡ç®±ï¼š</strong><br>' + adminEmails.join('<br>');
            } else {
                adminEmailsDiv.innerHTML = '<strong>ç›®å‰ç„¡ç®¡ç†å“¡å¸³è™Ÿ</strong>';
            }
        }

        function addUser() {
            const email = document.getElementById('newUserEmail').value.trim();
            const password = document.getElementById('newUserPassword').value.trim();
            const role = document.getElementById('newUserRole').value;
            if (!email || !password) {
                alert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½');
                return;
            }
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„ä¿¡ç®±æ ¼å¼');
                return;
            }
            if (users.find(u => u.email === email)) {
                alert('æ­¤ä¿¡ç®±å·²è¨»å†Š');
                return;
            }
            users.push({ email: email, password: password, role: role });
            alert('ä½¿ç”¨è€…æ–°å¢æˆåŠŸï¼');
            document.getElementById('newUserEmail').value = '';
            document.getElementById('newUserPassword').value = '';
            document.getElementById('newUserRole').value = 'user';
            loadUsers();
            loadAdminEmails();
        }

        function deleteUser(email) {
            if (email === (currentUser ? currentUser.email : '')) {
                alert('ç„¡æ³•åˆªé™¤ç•¶å‰ç™»å…¥çš„ä½¿ç”¨è€…');
                return;
            }
            if (confirm('ç¢ºå®šè¦åˆªé™¤ä½¿ç”¨è€… ' + email + ' å—ï¼Ÿ')) {
                users = users.filter(u => u.email !== email);
                loadUsers();
                loadAdminEmails();
                alert('ä½¿ç”¨è€…å·²åˆªé™¤');
            }
        }

        function changeUserRole(email, newRole) {
            const user = users.find(u => u.email === email);
            if (user) {
                user.role = newRole;
                alert('ä½¿ç”¨è€… ' + email + ' çš„æ¬Šé™å·²æ›´æ–°ç‚º ' + (newRole === 'admin' ? 'ç®¡ç†å“¡' : 'ä¸€èˆ¬ä½¿ç”¨è€…'));
                loadUsers();
                loadAdminEmails();
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('partImage');
            if (fileInput) {
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    const label = document.querySelector('.file-upload-label');
                    if (file) {
                        if (['image/jpeg', 'image/jpg'].includes(file.type)) {
                            label.textContent = 'å·²é¸æ“‡: ' + file.name;
                            label.style.color = '#10b981';
                        } else {
                            label.textContent = 'è«‹é¸æ“‡ JPG æˆ– JPEG æ ¼å¼çš„åœ–ç‰‡';
                            label.style.color = '#ef4444';
                            e.target.value = '';
                        }
                    } else {
                        label.textContent = 'é»æ“Šä¸Šå‚³ç…§ç‰‡ (JPG/JPEGæ ¼å¼)';
                        label.style.color = '#374151';
                    }
                });
            }
            init();
        });
    </script>
</body>
</html> + '
